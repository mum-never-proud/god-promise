{"version":3,"sources":["god-promise.js"],"names":["states","pending","fulfilled","rejected","noop","isThenable","v","then","GodPromise","executor","Error","$state","$value","undefined","$reason","$thenChain","$finallyChain","setTimeout","_onResolve","bind","_onReject","ex","onResolve","onReject","promise","push","sideEffect","reslove","reject","value","_notifyStateChange","reason","forEach","_applyChange","length","onResolveOrReject","valueOrReason","promiseOrValue","resolve","_","module","exports"],"mappings":"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","file":"god-promise.js","sourceRoot":"..","sourcesContent":["const states = {\n  pending: '<pending>',\n  fulfilled: '<fulfilled>',\n  rejected: '<rejected>'\n};\nconst noop = () => {};\nconst isThenable = v => v && v.then;\n\n/**\n * this is definitely not fit for production use\n * as it does not cover edge cases.\n * should be used only to understand how a promise works!\n */\n\nclass GodPromise {\n  constructor (executor) {\n    if (typeof executor !== 'function') {\n      throw Error('executor must be a function');\n    }\n\n    this.$state = states.pending;\n    this.$value = undefined;\n    this.$reason = undefined;\n    this.$thenChain = [];\n    this.$finallyChain = [];\n\n    setTimeout(() => {\n      try {\n        executor(\n          this._onResolve.bind(this),\n          this._onReject.bind(this)\n        );\n      } catch (ex) {\n        this._onReject(ex);\n      }\n    });\n  }\n\n  then (onResolve, onReject) {\n    const promise = new GodPromise(noop); // internal promise\n\n    this.$thenChain.push([promise, onResolve, onReject]);\n\n    return promise;\n  }\n\n  catch (onReject) {\n    return this.then(undefined, onReject);\n  }\n\n  finally (sideEffect) {\n    if (this.$state !== states.pending) {\n      sideEffect();\n\n      return this.$state = states.fulfilled\n      ? GodPromise.reslove(this.$value)\n      : GodPromise.reject(this.$reason);\n    }\n\n    const promise = new GodPromise(noop); // internal promise\n\n    this.$finallyChain.push([promise, sideEffect]);\n\n    return promise;\n  }\n\n  static resolve (value) {\n    return new GodPromise(resolve => resolve(value));\n  }\n\n  static reject (reason) {\n    return new GodPromise((_, reject) => reject(reason));\n  }\n\n  // private methods\n\n  _onResolve (value) {\n    if (this.$state === states.pending) {\n      this.$state = states.fulfilled;\n      this.$value = value;\n      this._notifyStateChange();\n    }\n  }\n\n  _onReject (reason) {\n    if (this.$state === states.pending) {\n      this.$state = states.rejected;\n      this.$reason = reason;\n      this._notifyStateChange();\n    }\n  }\n\n  _notifyStateChange () {\n    this.$thenChain.forEach(([promise, onResolve, onReject]) => {\n      if (this.$state === states.fulfilled) {\n        this._applyChange(promise, onResolve, this.$value);\n      } else if (this.$state === states.rejected) {\n        this._applyChange(promise, onReject, this.$reason);\n      }\n    });\n\n    this.$finallyChain.forEach(([promise, sideEffect]) => {\n      sideEffect();\n\n      if (this.$state === states.fulfilled) {\n        promise._onResolve(this.$value);\n      } else if (this.$state === states.rejected) {\n        promise._onReject(this.$reason);\n      }\n    });\n\n    this.$thenChain.length = 0;\n    this.$finallyChain.length = 0;\n  }\n\n  _applyChange (promise, onResolveOrReject, valueOrReason) {\n    if (typeof onResolveOrReject === 'function') {\n      const promiseOrValue = onResolveOrReject(valueOrReason);\n\n      if (isThenable(promiseOrValue)) {\n        promiseOrValue.then(\n          value => promise._onResolve(value),\n          reason => promise._onReject(reason)\n        );\n      } else {\n        promise._onResolve(promiseOrValue);\n      }\n    } else if (this.$state === states.fulfilled) {\n      promise._onResolve(this.$value);\n    } else if (this.$state === states.rejected) {\n      promise._onReject(this.$reason);\n    }\n  }\n}\n\nmodule.exports = GodPromise;\n"]}